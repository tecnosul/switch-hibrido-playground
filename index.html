<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Switch Híbrido</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">

</head>

<body>
    <div id="loader" style="height: 100vh; width: 100vw; background-color: #ffffff; position: absolute;">
        <div class="progress position-relative" style="top: 50%;">
            <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="3"></div>
        </div>
    </div>

    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto">Tecnosul</strong>
                <small>Switch Híbrido TD-D21</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                Olá, esse é o nosso Switch Híbrido. Você pode interagir com ele com os dedos ou com o mouse.
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
        crossorigin="anonymous"></script>

    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "/build/three.module.js"
            }
        }
    </script>

    <script type="module">

        import * as THREE from 'three';

        import { OrbitControls } from '/jsm/controls/OrbitControls.js';
        import { GLTFLoader } from '/jsm/loaders/GLTFLoader.js';

        let container, stats, clock, gui, mixer, actions, activeAction, previousAction;
        let camera, scene, renderer, model, face;

        const api = { state: 'Walking' };

        init();
        animate();

        function init() {

            container = document.createElement('div');
            document.body.appendChild(container);

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 100);
            camera.position.set(- 5, 3, 10);
            camera.lookAt(new THREE.Vector3(0, 2, 0));

            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xe0e0e0);
            scene.fog = new THREE.Fog(0xe0e0e0, 20, 100);

            clock = new THREE.Clock();

            // lights

            const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444);
            hemiLight.position.set(0, 20, 0);
            scene.add(hemiLight);

            const dirLight = new THREE.DirectionalLight(0xffffff);
            dirLight.position.set(0, 20, 10);
            scene.add(dirLight);

            // ground

            const mesh = new THREE.Mesh(new THREE.PlaneGeometry(2000, 2000), new THREE.MeshPhongMaterial({ color: 0x999999, depthWrite: false }));
            mesh.rotation.x = - Math.PI / 2;
            scene.add(mesh);

            const grid = new THREE.GridHelper(200, 40, 0x000000, 0x000000);
            grid.material.opacity = 0.2;
            grid.material.transparent = true;
            scene.add(grid);

            const loader = new GLTFLoader().setPath('/models/tecnosul/');
            loader.load('rack 1u 45cm 4.gltf', function (gltf) {

                console.log(gltf.scene);
                scene.add(gltf.scene);

                render();

            });


            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.outputEncoding = THREE.sRGBEncoding;
            container.appendChild(renderer.domElement);

            const controls = new OrbitControls(camera, renderer.domElement);
            controls.addEventListener('change', render); // use if there is no animation loop
            controls.minDistance = 2;
            controls.maxDistance = 10;
            controls.target.set(0.3, 0, - 2);
            controls.update();


            window.addEventListener('resize', onWindowResize);

            // stats
            // stats = new Stats();
            // container.appendChild(stats.dom);

        }

        function onWindowResize() {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function animate() {

            const dt = clock.getDelta();

            if (mixer) mixer.update(dt);

            requestAnimationFrame(animate);

            renderer.render(scene, camera);

            // stats.update();

        }


        const bar = document.querySelector('.progress-bar')

        THREE.DefaultLoadingManager.onLoad = function () {

            setTimeout(() => {
                document.querySelector('#loader').style.display = 'none'
                const toastLiveExample = document.getElementById('liveToast')
                const toast = new bootstrap.Toast(toastLiveExample)
                toast.show()
            }, 1000);

        };


        THREE.DefaultLoadingManager.onProgress = function (url, itemsLoaded, itemsTotal) {

            const porcent = parseInt(100 * itemsLoaded / itemsTotal)
            bar.setAttribute('aria-valuemax', itemsTotal)
            bar.style.width = porcent + '%'
            bar.setAttribute('aria-valuenow', itemsLoaded)

        };

        THREE.DefaultLoadingManager.onError = function (url) {

            console.log('There was an error loading ' + url);

        };

        function render() {

            renderer.render(scene, camera);

        }

        let full
        document.body.onclick = () => {
            if (!full) document.body.requestFullscreen()
        }
        document.body.ontouchstart = () => {
            if (!full) document.body.requestFullscreen()
        }

        document.addEventListener("fullscreenchange", function (e) {
            if (window.innerHeight == screen.height) {
                // browser is fullscreen
                full = true
            } else {
                full = false
            }
        });

        setInterval(() => {
            const toastLiveExample = document.getElementById('liveToast')
            const toast = new bootstrap.Toast(toastLiveExample)
            toast.show()
        }, 60000);

    </script>

</body>

</html>